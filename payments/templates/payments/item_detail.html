{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ item.name }}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <h1>{{ item.name }}</h1>
    <p>{{ item.description }}</p>
    <p>Price: {{ item.price }} {{ item.currency }}</p>

    <!-- Кнопка покупки -->
    <form action="{% url 'buy_item' item.id %}" method="POST" id="buy-form">
        {% csrf_token %}
        <button type="submit">Buy Now</button>
    </form>

    <!-- Форма добавления в заказ -->
    <h2>Add to Order</h2>
    <form action="{% url 'add_to_order' item.id %}" method="POST">
        {% csrf_token %}
        <label for="order_id">Select Order:</label>
        <select name="order_id" id="order_id">
            <option value="new">Create New Order</option>
            {% for order in orders %}
                <option value="{{ order.id }}">Order #{{ order.id }}</option>
            {% endfor %}
        </select>
        <button type="submit">Add to Order</button>
    </form>

    <a href="{% url 'home' %}">Back to Home</a>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        const stripe = Stripe('{{ stripe_public_key }}');
        document.getElementById('buy-form').addEventListener('submit', function(e) {
            e.preventDefault();
            fetch('{% url 'buy_item' item.id %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    stripe.redirectToCheckout({ sessionId: data.sessionId });
                }
            });
        });
    </script>
</body>
</html>