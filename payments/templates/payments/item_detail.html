{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ item.name }}</title>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <h1>{{ item.name }}</h1>
    <p>{{ item.description }}</p>
    <p>Price: {{ item.price }} {{ item.currency|upper }}</p>
    <button onclick="buyItem()">Buy</button>

    <script>
        const stripe = Stripe('{{ stripe_public_key }}');
        function buyItem() {
            fetch('/buy/{{ item.id }}/', {
                method: 'GET',
            })
            .then(response => response.json())
            .then(data => {
                if (data.sessionId) {
                    stripe.redirectToCheckout({ sessionId: data.sessionId });
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => alert('Error: ' + error));
        }
    </script>
</body>
</html>